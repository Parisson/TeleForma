{% extends "teleforma/course_media.html" %}
{% load telemeta_utils %}
{% load teleforma_tags %}
{% load i18n %}

{% block extra_javascript %}

<script type="text/javascript" src="{{ STATIC_URL }}jqchat/jqchat.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    InitChatWindow("{% url jqchat_ajax room.id %}", null);
    });
</script>

<script type="text/javascript" src="{{ STATIC_URL }}teleforma/js/pdf-min.js"></script>

<script type="text/javascript">
    PDFJS.workerSrc = '{% url telemeta-js "pdf-min.js" %}';
</script>

<script type="text/javascript">
'use strict';

//
// Fetch the PDF document from the URL using promices
//
PDFJS.getDocument('{% url teleforma-document-download document.id %}').then(function(pdf) {
  // Using promise to fetch the page
  pdf.getPage(1).then(function(page) {
    var scale = 1.5;
    var viewport = page.getViewport(scale);

    //
    // Prepare canvas using PDF page dimensions
    //
    var canvas = document.getElementById('the-canvas');
    var context = canvas.getContext('2d');
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    //
    // Render PDF page into canvas context
    //
    var renderContext = {
      canvasContext: context,
      viewport: viewport
    };
    page.render(renderContext);
  });
});
</script>

{% endblock extra_javascript %}

{% block course %}
<div class="course_media">

<div class="course_title">{{ document.title }}{% if document.description %} - {{ document.description }}{% endif %}
</div>

<div class="media">
<canvas id="the-canvas" style="border:1px solid black;"/>
</div>

{% block general_info %}
<div class="course_content" id="media_infos">
<dl class="listing">
<dt>{% trans "Title" %}</dt><dd>{{ document.title }}</dd>
</dl>
</div>
{% endblock general_info %}

</div>
{% endblock course %}

{% block chat %}
{% if room %}
<div id="module-set" style="width: 22%">
<div class="module">
<h3><img src="{% url telemeta-images "vox_wh.png" %}" alt="rss" style="vertical-align:middle" />{% trans "Local tweeter" %}</h3>

<div style="background: white;">
<div id="chatwindow"><span id="loading">Loading...</span></div>
<form id="chatform">{% csrf_token %}
<label for="msg"></label>
<input type="text" id="msg" size="16" />
<input type="submit" value="{% trans "Send" %}" />
</form>
<!-- <script type="text/javascript">document.getElementById("msg").focus();</script> -->
</div>
</div>
</div>
{% endif %}
{% endblock chat %}
