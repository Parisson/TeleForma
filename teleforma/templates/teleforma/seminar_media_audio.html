{% extends "teleforma/seminar_media_video.html" %}
{% load telemeta_utils %}
{% load teleforma_tags %}
{% load i18n %}

{% block module-action %}
{% for media in media.all %}
    {% if media.item.file and media.is_published and media.item.file.path|in_download_formats %}
     <div class="module_action">
     <a href="{{ MEDIA_URL }}{{ media.item.file }}" class="component_icon button" id="action_red"><img src="{{STATIC_URL}}teleforma/images/download_media.png" alt="" style="vertical-align:middle" />&nbsp;{% trans "Download" %}</a>
     </div>
    {% endif %}
{% endfor %}
{% endblock module-action %}

{% block course %}
<div class="course_media">

<div class="course_title">

    <div style="float: left; font-size: 0.9em;">
        <a href="{% url teleforma-seminar-detail seminar.id %}" class="component_icon button icon_previous">&nbsp;{% trans "Back" %}</a>
    </div>

    <div style="float: right; font-size: 0.9em;">
        <a href="{% url teleforma-media-video seminar.id media.id %}" class="component_icon button icon_clap">&nbsp;{% trans "Video" %}</a>

        {% if user.is_staff %}
        <a id="publish" href="#" class="{% if media.is_published %}component_icon button icon_ok{% else %}component_icon button icon_delete{% endif %}">{% if media.is_published %}{% trans " published" %}{% else %}{% trans " rejected" %}{% endif %}</a>
        {% endif %}
    </div>

    <div style="text-align: center; padding: 0em .5em 0em .5em;">
      <a href="{% url teleforma-seminar-detail seminar.id %}">{{ seminar.title }}</a>
    </div>

</div>

{% if access_error %}
  <p>{{ access_error }}</p>
  <p>{{ message }}</p>

{% else %}
<div class="media">

<div style="margin-top:1em;">
{% if media.item.related.all %}
 {% for related in media.item.related.all %}
  {% if related.title == "preview" %}
   <img src="{{ MEDIA_URL }}{{ related.file }}" width="300px" alt="" />
  {% endif %}
 {% endfor %}
{% else %}
 snapshot
{% endif %}
</div>

<div class="audio">
<audio id="audio_1" controls preload="auto">
    {% for transcoded in media.item.transcoded.all %}
     {% if "audio" in transcoded.mime_type %}
        <source src="{{ MEDIA_URL }}{{ transcoded.file }}#t=0" type="{{ transcoded.mime_type }}" />
     {% endif %}
    {% endfor %}
</audio>
</div>

</div>
{% endif %}

{% block general_info %}
<div class="course_content" id="media_infos">
<dl class="listing">


<dt>{% trans "Title" %}</dt><dd>{{ media.item.title }} - {{ seminar.sub_title }} - {{ media.rank }}</dd>

{% with seminar.professor.all as professors %}
  {% if professors %}
    <dt>{% if professors.count > 1 %}{% trans "Professors" %}{% else %}{% trans "Professor" %}{% endif %}</dt>
    <dd>{% for professor in professors %}{{ professor }}{% if not forloop.last %},{% endif %} {% endfor %}</a></dd>
  {% endif %}
{% endwith %}

{% if user.is_staff or user.is_superuser %}
<dt>{% trans "Date added" %}</dt><dd>{{ media.date_added }}</dd>
<dt>{% trans "Date modified" %}</dt><dd>{{ media.date_modified }}</dd>
<dt>{% trans "Media ID" %}</dt><dd>{{ media.id }}</dd>
{% endif %}


</dl>
</div>
{% endblock general_info %}

</div>
{% endblock course %}

{% block chat %}
{% endblock chat %}

{% block index %}
<div class="module">
  <h3><img src="{{STATIC_URL}}telemeta/images/module_playlist.png" alt="status" style="vertical-align:middle" /> {% trans "Audio index" %}</h3>
 <div id="index">
  <ul>
  {% for marker in media.item.markers.all %}
  <li><a href="#" onclick="jumpToTimeoffset({{ marker.time|point }});">{{ marker.title }}</a></li>
  {% endfor %}
  </ul>
 </div>
</div>

<script type="text/javascript">

var media = document.getElementById("audio_1");

// jump to time offset action using HTML5
function jumpToTimeoffset(time) {
    var url = media.currentSrc;
    var abs_url = url.split("#")[0];
    media.currentTime =  time;
    media.play();
}

$(document).ready(function(){
    $('#audio_1').bind('contextmenu',function() { return false; });
});

</script>

{% endblock index %}

{% block module-action-right %}
{% if media.item.file and media.is_published and media.item.file.path|in_download_formats %}
 <div class="module_action">
   <a href="{{ MEDIA_URL }}{{ media.item.transcoded.all.0.file }}" class="component_icon button" id="action_red"><img src="{{STATIC_URL}}teleforma/images/download_media.png" alt="" style="vertical-align:middle" />&nbsp;{% trans "Download" %}</a>
 </div>
{% endif %}
{% endblock module-action-right %}
