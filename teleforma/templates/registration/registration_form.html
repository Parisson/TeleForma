{% extends "registration/registration_base.html" %}
{% load i18n %}
{% load telemeta_utils %}
{% load teleforma_tags %}

{% block extra_javascript %}
    <script src="/static/teleforma/js/datepicker-fr.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("[name='birthday']").datepicker({
                dateFormat:'dd/mm/yy',
                changeMonth: true,
                changeYear: true,
                yearRange: "-100:+0"
            });
        });
    </script>
{% endblock %}

{% block extra_stylesheets %}
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
{% endblock %}

{% block title %}
    <center>{% trans "Pre-registration" %} - {% description %}</center>{% endblock %}

{% block content %}
    <center>
        <form class="register" id="_registerForm" method="post" action="" enctype="multipart/form-data"
              data-ajax="false">{% csrf_token %}

            {{ introduction|safe }}

            <h2><span class="error">Tous les champs sont requis</span></h2>
            <table>

                {% for field in form.visible_fields %}
                    {% if field.name != 'accept' %}
                        <tr>
                            <th>{{ field.label_tag }}</th>
                            <td>
                                {{ field.errors }}
                                {{ field }}
                                <br/>
                                <span class="helptext">
                            {{ field.help_text }}
                        </span>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
                {% for field in form.visible_fields %}
                    {% if field.name == 'accept' %}
                        <tr>
                            <th>J'accepte les <a
                                    href="http://crfpa.pre-barreau.com/tarifs/conditions-generales-dinscription">conditions
                                générales d'inscription</a></th>
                            <td>
                                {{ field.errors }}
                                {{ field }}
                                <br/>
                                <span class="helptext">
                            {{ field.help_text }}
                        </span>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </table>
            <br><br>
            <a href="#" class="component_icon button" id="action_green" onclick="$('#_registerForm').submit();"><img
                    src="/static/telemeta/images/next.png" alt=""
                    style="vertical-align:middle"/>&nbsp;{% trans "Submit" %}</a>
        </form>
    </center>
    <script>

        var trainingId;

        function updateTrainings(){
            // filter trainings according to period
            var periodId = $("#id_period").val();
            var platformOnly = $("#id_platform_only").val();
            if (!periodId || !platformOnly) {
                $('#id_training').html('<option value="" selected="selected">---------</option>');
            } else {
                $.ajax({
                    url: "/update-training/" + periodId + "/",
                    data: {"period_id": periodId, "training_id": trainingId, "platform_only":platformOnly},
                    dataType: "html",
                    type: "post",
                    success: function (data) {
                        $('#id_training').html(data);
                    }
                });
            }
        }
        $(document).ready(function () {
            trainingId =  $("#id_training").val();
            updateTrainings();
            $("#id_period,  #id_platform_only").change(updateTrainings);

        });
    </script>
    <style>
        select {
            width: 222px;
        }
    </style>
{% endblock %}
