version: '3'

services:
  app:
    build: .
    command: /bin/sh app/bin/app.sh
    volumes:
      - ./app/:/srv/app
      - ./bin:/srv/bin
      - ./teleforma/:/srv/lib/teleforma/teleforma
      - ./var/media:/srv/media
      - ./var/backup:/srv/backup
      - ./var/static:/srv/static
    ports:
      - "8000:8000"
    links:
      - db

  db:
    image: mariadb
    environment:
      - MYSQL_ROOT_PASSWORD=mysecretrootpassword
      - MYSQL_DATABASE=teleforma
      - MYSQL_USER=teleforma
      - MYSQL_PASSWORD=mysecretpassword
    volumes:
      - ./var/lib/mysql/:/var/lib/mysql
      - ./var/log/mysql/:/var/log/mysql
      - ./var/backup/:/srv/backup

  memcached:
      image: memcached:alpine
      entrypoint:
          - memcached
          - -m 1024
          - -I 128m
          - -v

volumes:
    app:
    db:
